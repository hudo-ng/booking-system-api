generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String            @id @default(uuid())
  email                    String            @unique
  password                 String
  name                     String
  role                     Role
  createdAt                DateTime          @default(now())
  colour                   String?
  isAdmin                  Boolean           @default(false)
  isOwner                  Boolean           @default(false)
  percentage_clean         Float?            @default(0)
  percentage_shared        Float?            @default(0)
  percentage_work          Float?            @default(0)
  phone_number             String            @default("111-111-1111")
  photo_url                String?
  show_on_calendar_booking Boolean           @default(false)
  slug                     String            @unique
  start_price              Float?
  wage                     Float?            @default(0)
  is_reception             Boolean           @default(false)
  currentDeviceId          String?
  Appointment              Appointment[]     @relation("AssignedBy")
  Appoinment               Appointment[]
  CleanSchedule            CleanSchedule[]
  DeviceToken              DeviceToken[]
  RecurringSeries          RecurringSeries[]
  timeOff                  TimeOff[]
  WorkOverride             WorkOverride[]
  WorkSchedule             WorkSchedule[]
  WorkShift                WorkShift[]
  workingHours             WorkingHours[]
  Notification             Notification[]
}

model CleanSchedule {
  id        String   @id @default(uuid())
  userId    String
  weekday   Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, weekday])
}

model Appointment {
  id                     String                  @id @default(uuid())
  employeeId             String
  customerName           String
  email                  String
  phone                  String
  detail                 String
  status                 AppointmentStatus       @default(pending)
  startTime              DateTime?
  endTime                DateTime?
  createdAt              DateTime?               @default(now())
  address                String?
  deposit_amount         Float?
  deposit_category       String?
  dob                    DateTime?
  extra_deposit_category String?
  paidWith               String?
  quote_amount           Float?
  completed_photo_url    String?
  isException            Boolean                 @default(false)
  occurrenceIndex        Int?
  seriesId               String?
  assignedById           String?
  assignedBy             User?                   @relation("AssignedBy", fields: [assignedById], references: [id])
  employee               User                    @relation(fields: [employeeId], references: [id])
  RecurringSeries        RecurringSeries?        @relation(fields: [seriesId], references: [id])
  AppointmentAttachment  AppointmentAttachment[]
  AppointmentHistory     AppointmentHistory[]
}

model Notification {
  id                     String   @id @default(uuid())
  created_by             String
  created_at             DateTime @default(now()) @map("created_at")
  updated_at             DateTime @updatedAt @map("updated_at")
  description            String
  customer_name          String
  quote_amount           Float    @default(0)
  deposit_amount         Float    @default(0)
  deposit_category       String
  extra_deposit_category String?
  appointment_start_time DateTime
  appointment_end_time   DateTime
  title                  String?
  not_read               Boolean  @default(true)
  createdBy              User     @relation(fields: [created_by], references: [id])

  @@map("notifications")
}

model AppointmentAttachment {
  id            String      @id @default(uuid())
  appointmentId String
  fileId        String
  url           String
  mime          String
  size          Int
  width         Int?
  height        Int?
  createdAt     DateTime    @default(now())
  filename      String
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

model AppointmentHistory {
  id            String      @id @default(uuid())
  appointmentId String
  fieldChanged  String
  oldValue      String
  newValue      String
  changedAt     DateTime    @default(now())
  changedBy     String
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

model WorkingHours {
  id             String  @id @default(uuid())
  employeeId     String
  weekday        Int
  startTime      String?
  endTime        String?
  intervalLength Int?
  type           String  @default("fixed")
  employee       User    @relation(fields: [employeeId], references: [id])

  @@index([employeeId, weekday], map: "employeeId_weekday")
}

model TimeOff {
  id         String   @id @default(uuid())
  employeeId String
  date       DateTime
  reason     String?
  employee   User     @relation(fields: [employeeId], references: [id])
}

model WorkSchedule {
  id        String   @id @default(uuid())
  userId    String
  dayOfWeek Int
  startTime DateTime
  endTime   DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model WorkShift {
  id        String    @id @default(uuid())
  userId    String
  clockIn   DateTime
  clockOut  DateTime?
  createdAt DateTime  @default(now())
  user      User      @relation(fields: [userId], references: [id])
}

model WorkOverride {
  id         String   @id @default(uuid())
  userId     String
  date       DateTime
  newEndTime DateTime
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, date], name: "userId_date")
}

model DeviceToken {
  id       String   @id @default(uuid())
  userId   String
  token    String   @unique
  platform String?
  lastSeen DateTime @default(now())
  enabled  Boolean  @default(true)
  user     User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model RecurringSeries {
  id           String         @id @default(uuid())
  employeeId   String
  startDate    DateTime
  endDate      DateTime?
  frequency    RecurrenceFreq
  interval     Int            @default(1)
  count        Int?
  byWeekday    Int[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  isActive     Boolean        @default(true)
  appointments Appointment[]
  employee     User           @relation(fields: [employeeId], references: [id])
}

enum AppointmentStatus {
  pending
  accepted
  declined
}

enum Role {
  admin
  employee
}

enum RecurrenceFreq {
  daily
  weekly
  monthly
}
