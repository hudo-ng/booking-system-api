generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String            @id @default(uuid())
  email                    String            @unique
  password                 String
  name                     String
  role                     Role
  createdAt                DateTime          @default(now())
  colour                   String?
  isAdmin                  Boolean           @default(false)
  isOwner                  Boolean           @default(false)
  percentage_clean         Float?            @default(0)
  percentage_shared        Float?            @default(0)
  percentage_work          Float?            @default(0)
  phone_number             String            @default("111-111-1111")
  photo_url                String?
  show_on_calendar_booking Boolean           @default(false)
  slug                     String            @unique
  start_price              Float?
  wage                     Float?            @default(0)
  is_reception             Boolean           @default(false)
  currentDeviceId          String?
  deletedAt                DateTime?
  Appointment              Appointment[]     @relation("AssignedBy")
  Appoinment               Appointment[]
  CleanSchedule            CleanSchedule[]
  DeviceToken              DeviceToken[]
  RecurringSeries          RecurringSeries[]
  timeOff                  TimeOff[]
  WorkOverride             WorkOverride[]
  WorkSchedule             WorkSchedule[]
  WorkShift                WorkShift[]
  workingHours             WorkingHours[]
  Notification             Notification[]
}

model CleanSchedule {
  id        String   @id @default(uuid())
  userId    String
  weekday   Int
  createdAt DateTime @default(now())
  shiftType String   @default("day")
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, weekday, shiftType])
}

model Appointment {
  id                     String                  @id @default(uuid())
  employeeId             String
  customerName           String
  email                  String
  phone                  String
  detail                 String
  status                 AppointmentStatus       @default(pending)
  startTime              DateTime?
  endTime                DateTime?
  createdAt              DateTime?               @default(now())
  updatedAt              DateTime                @default(now()) @updatedAt
  address                String?
  deposit_amount         Float?
  deposit_status         DepositStatus           @default(ignored)
  deposit_category       String?
  dob                    DateTime?
  extra_deposit_category String?
  paidWith               String?
  quote_amount           Float?
  completed_photo_url    String?
  isException            Boolean                 @default(false)
  occurrenceIndex        Int?
  seriesId               String?
  assignedById           String?
  payment_id             String?
  payment_status         PaymentStatus?
  deposit_has_been_used  Boolean?                @default(false)
  assignedBy             User?                   @relation("AssignedBy", fields: [assignedById], references: [id])
  employee               User                    @relation(fields: [employeeId], references: [id])
  RecurringSeries        RecurringSeries?        @relation(fields: [seriesId], references: [id])
  webPayment             WebPaymentTracking?
  AppointmentAttachment  AppointmentAttachment[]
  AppointmentHistory     AppointmentHistory[]
  VerificationCodes      VerificationCode[]
  DepositAppointment     DepositAppointment[]
}

model DepositAppointment {
    id             String      @id @default(uuid())
    status                 DepositStatus       @default(pending)
    updatedAt              DateTime?               @default(now())
    createdAt              DateTime?               @default(now())
    attachment_url         String?
    deposit_amount         Float?
    deposit_category       String?
    extra_deposit_category String?
    appointment_id String
    appointment    Appointment @relation(fields: [appointment_id], references: [id])
}

model VerificationCode {
  id             String      @id @default(uuid())
  appointment_id String
  phone          String
  code           String
  createdAt      DateTime    @default(now())
  expiresAt      DateTime
  isUsed         Boolean     @default(false)
  appointment    Appointment @relation(fields: [appointment_id], references: [id])
}

model Notification {
  id                     String   @id @default(uuid())
  created_by             String
  created_at             DateTime @default(now()) @map("created_at")
  updated_at             DateTime @updatedAt @map("updated_at")
  description            String
  customer_name          String
  quote_amount           Float    @default(0)
  deposit_amount         Float    @default(0)
  deposit_category       String
  extra_deposit_category String?
  appointment_start_time DateTime
  appointment_end_time   DateTime
  title                  String?
  not_read               Boolean  @default(true)
  createdBy              User     @relation(fields: [created_by], references: [id])

  @@map("notifications")
}

model MiniPhoto {
  id         String   @id @default(uuid())
  custom_id  String
  photo_url  String
  style      String
  category   String
  is_showed  Boolean  @default(false)
  updated_at DateTime @updatedAt @map("updated_at")
  created_at DateTime @default(now()) @map("created_at")
  created_by String
}

model AppointmentAttachment {
  id            String      @id @default(uuid())
  appointmentId String
  fileId        String
  url           String
  mime          String
  size          Int
  width         Int?
  height        Int?
  createdAt     DateTime    @default(now())
  filename      String
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

model AppointmentHistory {
  id            String      @id @default(uuid())
  appointmentId String
  fieldChanged  String
  oldValue      String
  newValue      String
  changedAt     DateTime    @default(now())
  changedBy     String
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

model WorkingHours {
  id             String  @id @default(uuid())
  employeeId     String
  weekday        Int
  startTime      String?
  endTime        String?
  intervalLength Int?
  type           String  @default("fixed")
  employee       User    @relation(fields: [employeeId], references: [id])

  @@index([employeeId, weekday], map: "employeeId_weekday")
}

model TimeOff {
  id         String        @id @default(uuid())
  employeeId String
  date       DateTime
  reason     String?
  batchId    String?
  createdAt  DateTime      @default(now())
  reviewedAt DateTime?
  reviewedBy String?
  status     TimeOffStatus @default(PENDING)
  employee   User          @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, date])
}

model WorkSchedule {
  id        String   @id @default(uuid())
  userId    String
  dayOfWeek Int
  startTime DateTime
  endTime   DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model WorkShift {
  id        String    @id @default(uuid())
  userId    String
  clockIn   DateTime
  clockOut  DateTime?
  createdAt DateTime  @default(now())
  user      User      @relation(fields: [userId], references: [id])
}

model WorkOverride {
  id         String   @id @default(uuid())
  userId     String
  date       DateTime
  newEndTime DateTime
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, date], name: "userId_date")
}

model DeviceToken {
  id       String   @id @default(uuid())
  userId   String
  token    String   @unique
  platform String?
  lastSeen DateTime @default(now())
  enabled  Boolean  @default(true)
  user     User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model RecurringSeries {
  id           String         @id @default(uuid())
  employeeId   String
  startDate    DateTime
  endDate      DateTime?
  frequency    RecurrenceFreq
  interval     Int            @default(1)
  count        Int?
  byWeekday    Int[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  isActive     Boolean        @default(true)
  appointments Appointment[]
  employee     User           @relation(fields: [employeeId], references: [id])
}

model TrackingPayment {
  id                  String   @id @default(uuid())
  referenceId         String
  invoiceNumber       String?
  batchNumber         String?
  transactionNumber   String?
  paymentType         String
  transactionType     String
  authCode            String?
  voided              Boolean  @default(false)
  pnReferenceId       String?
  totalAmount         Float?
  amount              Float?
  tipAmount           Float?
  feeAmount           Float?
  taxAmount           Float?
  cardType            String?
  entryType           String?
  last4               String?
  first4              String?
  BIN                 String?
  name                String?
  emvApplicationName  String?
  emvAID              String?
  emvTVR              String?
  emvTSI              String?
  emvIAD              String?
  emvARC              String?
  hostResponseCode    String?
  hostResponseMessage String?
  resultCode          String?
  statusCode          String?
  message             String?
  detailedMessage     String?
  artist              String
  payment_method      String
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  item_service        String?
  document_id         String?
  saline_price        Float?
  service_price       Float?
  customer_name       String?
  customer_phone      String?
  jewelry_price       Float?
}

model SignInCustomer {
  id           String         @id @default(uuid())
  name         String
  email        String
  dob          String
  phone        String
  address      String
  city         String
  state        String 
  zip_code     String
  document_id         String @unique
  service             String
  spending_artist     String
  spending_services   String?
  spending_amount     Float?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model WebPaymentTracking {
  id                String @id @default(cuid())
  provider          String
  providerPaymentId String @unique
  method            String

  amount   Decimal
  currency String

  status    String
  avsStatus String?
  cvvStatus String?

  bookingId String?      @unique
  booking   Appointment? @relation(fields: [bookingId], references: [id])

  rawResponse Json

  createdAt DateTime @default(now())
}

enum AppointmentStatus {
  pending
  accepted
  declined
}

enum DepositStatus {
  pending
  accepted
  declined
  ignored
}
enum Role {
  admin
  employee
}

enum RecurrenceFreq {
  daily
  weekly
  monthly
}

enum TimeOffStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PaymentStatus {
  PAID
  REFUNDED
  VOIDED
}
